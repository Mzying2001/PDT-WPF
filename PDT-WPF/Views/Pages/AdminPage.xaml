<Page x:Class="PDT_WPF.Views.Pages.AdminPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:PDT_WPF.Views.Pages"
      xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
      xmlns:hc="https://handyorg.github.io/handycontrol"
      xmlns:Utils="clr-namespace:PDT_WPF.Views.Utils"
      mc:Ignorable="d"
      
      d:DesignWidth="800"
      Title="后台管理"
      DataContext="{Binding Source={StaticResource Locator}, Path=AdminPage}">

    <hc:ScrollViewer
        IsInertiaEnabled="True"
        VerticalScrollBarVisibility="Auto">

        <StackPanel
            Margin="0,0,10,0">
            <Expander
                Margin="0,10,0,0"
                Header="管理员登录"
                IsExpanded="True">
                <Expander.Resources>
                    <Style
                        TargetType="TextBlock">
                        <Setter
                            Property="VerticalAlignment"
                            Value="Center"/>
                    </Style>
                </Expander.Resources>
                <Grid>
                    <!--已登录显示界面-->
                    <TextBlock
                        Margin="10,20"
                        Visibility="{Binding AdminMode, Converter={StaticResource Boolean2VisibilityConverter}}">
                        已登录管理员账号：<Run Text="{Binding AdminAccount}"/> | <Hyperlink Command="{Binding AdminLogoutCmd}">退出</Hyperlink>
                    </TextBlock>
                    <!--未登录显示界面-->
                    <StackPanel
                        Margin="10,20"
                        Orientation="Horizontal"
                        IsEnabled="{Binding IsLoggingIn, Converter={StaticResource Boolean2BooleanReConverter}}"
                        Visibility="{Binding AdminMode, Converter={StaticResource Boolean2VisibilityReConverter}}">
                        <TextBlock
                            Text="账号："/>
                        <TextBox
                            Width="150"
                            Text="{Binding AdminAccount, UpdateSourceTrigger=PropertyChanged}"/>
                        <TextBlock
                            Margin="10,0,0,0"
                            Text="密码："/>
                        <PasswordBox
                            Width="150"
                            Utils:PasswordBoxHelper.Password="{Binding AdminPassword, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            <i:Interaction.Behaviors>
                                <Utils:PasswordBoxBehavior/>
                            </i:Interaction.Behaviors>
                        </PasswordBox>
                        <Button
                            Margin="10,0,0,0"
                            Style="{StaticResource ButtonPrimary}"
                            Content="确定"
                            Command="{Binding AdminLoginCmd}"/>
                    </StackPanel>
                </Grid>
            </Expander>

            <Expander
                Header="人工验证获取验证码"
                IsExpanded="True">
                <Grid
                    IsEnabled="{Binding AdminMode}">
                    <StackPanel
                        Margin="10,20"
                        Orientation="Horizontal"
                        IsEnabled="{Binding IsGettingVerificationCode, Converter={StaticResource Boolean2BooleanReConverter}}">
                        <TextBlock
                            VerticalAlignment="Center"
                            Text="学号："/>
                        <TextBox
                            x:Name="getVerificationCodeTextBox"
                            Width="150"/>
                        <Button
                            Margin="10,0,0,0"
                            Content="获取"
                            Command="{Binding GetVerificationCodeCmd}"
                            CommandParameter="{Binding ElementName=getVerificationCodeTextBox, Path=Text}"/>
                    </StackPanel>
                </Grid>
            </Expander>

            <Expander
                Header="轮播图"
                IsExpanded="True">
                <Grid
                    IsEnabled="{Binding AdminMode}">
                    <StackPanel
                        Margin="10"
                        IsEnabled="{Binding IsLoadingBoardPhotos, Converter={StaticResource Boolean2BooleanReConverter}}">
                        <StackPanel
                            Margin="0,0,0,10"
                            Orientation="Horizontal">
                            <Button
                                Content="获取数据"
                                Command="{Binding LoadBoardPhotosCmd}"/>
                        </StackPanel>
                        <ListView
                            Height="300"
                            ItemsSource="{Binding BoardPhotos}">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn
                                        Header="ID"
                                        DisplayMemberBinding="{Binding ID}"/>
                                    <GridViewColumn
                                        Header="名称"
                                        DisplayMemberBinding="{Binding Name}"/>
                                    <GridViewColumn
                                        Header="创建日期"
                                        DisplayMemberBinding="{Binding CreatedAt}"/>
                                    <GridViewColumn
                                        Header="更新日期"
                                        DisplayMemberBinding="{Binding UpdatedAt}"/>
                                    <GridViewColumn
                                        Header="删除日期"
                                        DisplayMemberBinding="{Binding DeletedAt}"/>
                                    <GridViewColumn
                                        Header="图片链接">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock>
                                                    <Hyperlink
                                                        Foreground="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ListViewItem}, Path=Foreground}"
                                                        Command="{Binding Source={StaticResource Locator}, Path=AdminPage.OpenLinkCmd}"
                                                        CommandParameter="{Binding PhotoUrl}">
                                                        <TextBlock
                                                            Text="{Binding PhotoUrl}"/>
                                                    </Hyperlink>
                                                </TextBlock>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn
                                        Header="目标链接">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock>
                                                    <Hyperlink
                                                        Foreground="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ListViewItem}, Path=Foreground}"
                                                        Command="{Binding Source={StaticResource Locator},Path=AdminPage.OpenLinkCmd}"
                                                        CommandParameter="{Binding Link}">
                                                        <TextBlock
                                                            Text="{Binding Link}"/>
                                                    </Hyperlink>
                                                </TextBlock>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn
                                        Header="操作">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <Button
                                                    Content="删除"
                                                    Command="{Binding Source={StaticResource Locator}, Path=AdminPage.DeleteBoardPhotoCmd}"
                                                    CommandParameter="{Binding}"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </StackPanel>
                </Grid>
            </Expander>

            <Expander
                Header="比赛栏"
                IsExpanded="True">
                <Grid
                    IsEnabled="{Binding AdminMode}">
                </Grid>
            </Expander>
        </StackPanel>

    </hc:ScrollViewer>
</Page>
